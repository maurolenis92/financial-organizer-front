<div class="budget-expenses-step">
  <div class="budget-expenses-step__header">
    <div class="budget-expenses-step__icon">
      <mat-icon class="material-icons">shopping_cart</mat-icon>
    </div>
    <div class="budget-expenses-step__title">
      <h2>Gastos</h2>
      <p>Registra todos los gastos planificados de tu presupuesto</p>
    </div>
  </div>

  <form [formGroup]="formExpense" class="expense-form">
    <div class="expense-form__card">
      <div class="expense-form__header">
        <mat-icon class="material-icons">add_circle</mat-icon>
        <h3>Agregar Nuevo Gasto</h3>
      </div>

      <div class="expense-form__fields">
        <div class="expense-form__field">
          <fs-input
            formControlName="amount"
            label="Monto"
            type="number"
            placeholder="0.00"
          ></fs-input>
        </div>
        <div class="expense-form__field">
          <fs-input
            formControlName="concept"
            label="Concepto"
            type="text"
            placeholder="Ej: Alquiler, Comida, Transporte"
          ></fs-input>
        </div>
        <div class="expense-form__field">
          <fs-select-input
            formControlName="category"
            [options]="categories"
            label="Categoría"
            placeholder="Selecciona una categoría"
          ></fs-select-input>
        </div>
        <div class="expense-form__field">
          <fs-select-input
            formControlName="status"
            [options]="statuses"
            label="Estado"
            placeholder="Selecciona el estado"
          ></fs-select-input>
        </div>
      </div>

      <div class="expense-form__actions">
        <fs-button
          type="button"
          [disabled]="buttonDisabled"
          (click)="addExpense()"
          label="Agregar Gasto"
        ></fs-button>
      </div>
    </div>
  </form>

  <div class="expense-list">
    <div class="expense-list__header">
      <h3>Lista de Gastos</h3>
      @if (formArray.controls.length > 0) {
        <span class="expense-list__count">{{ formArray.controls.length }} gasto(s)</span>
      }
    </div>

    @if (formArray.controls.length === 0) {
      <div class="expense-list__empty">
        <div class="empty-state">
          <mat-icon class="material-icons">receipt_long</mat-icon>
          <h4>No hay gastos aún</h4>
          <p>Comienza agregando tu primer gasto usando el formulario de arriba</p>
        </div>
      </div>
    } @else {
      <div class="expense-list__items">
        @for (item of formArray.controls; track $index) {
          <div class="expense-card" [attr.data-category]="item.get('category')?.value">
            <div class="expense-card__icon">
              <mat-icon class="material-icons">trending_down</mat-icon>
            </div>
            <div class="expense-card__content">
              <div class="expense-card__header">
                <span class="expense-card__number">Gasto #{{ $index + 1 }}</span>
                <div class="expense-card__badges">
                  <span
                    class="expense-card__category"
                    [attr.data-category]="item.get('category')?.value.value"
                  >
                    {{ item.get('category')?.value.label }}
                  </span>
                  <span
                    class="expense-card__status"
                    [attr.data-status]="item.get('status')?.value.value"
                  >
                    {{ item.get('status')?.value.label }}
                  </span>
                </div>
              </div>
              <div class="expense-card__details">
                <div class="expense-card__detail">
                  <span class="label">Concepto:</span>
                  <span class="value">{{ item.get('concept')?.value }}</span>
                </div>
                <div class="expense-card__detail expense-card__detail--amount">
                  <span class="label">Monto:</span>
                  <span class="value"
                    >${{ item.get('amount')?.value | number: '1.2-2' }}</span
                  >
                </div>
              </div>
            </div>
            <div class="expense-card__actions">
              <button
                class="btn-icon btn-icon--danger"
                (click)="removeExpense($index)"
                type="button"
              >
                <mat-icon class="material-icons">delete</mat-icon>
              </button>
            </div>
          </div>
        }
      </div>
    }
  </div>
</div>
