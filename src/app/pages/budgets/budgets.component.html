<div class="budgets">
  <div class="budgets__header">
    <div class="budgets__header-info">
      <h1>Mis Presupuestos</h1>
      <p>Administra y visualiza todos tus presupuestos</p>
    </div>
    <fs-button
      (click)="newBudget()"
      icon="add"
      type="button"
      id="btn-new-budget"
      label="Nuevo presupuesto"
    ></fs-button>
  </div>

  @if (budgets$().budgets.length > 0) {
    <div class="budgets__cards">
      @for (item of budgets$().budgets; track item.id) {
        <div class="budget-card" [attr.data-status]="getStatus(item)">
          <div class="budget-card__header">
            <div class="budget-card__title-row">
              <h3>{{ item.name }}</h3>
              <div class="budget-card__title-actions">
                <span class="budget-card__badge" [attr.data-status]="getStatus(item)">
                  {{ getStatusLabel(item) }}
                </span>
                <button
                  mat-icon-button
                  [matMenuTriggerFor]="menu"
                  class="budget-card__menu-btn"
                >
                  <mat-icon>more_vert</mat-icon>
                </button>
                <mat-menu #menu="matMenu">
                  <button mat-menu-item (click)="duplicateBudget(item)">
                    <mat-icon>content_copy</mat-icon>
                    <span>Crear copia</span>
                  </button>
                  <button mat-menu-item (click)="deleteBudget(item.id, item.name)">
                    <mat-icon>delete</mat-icon>
                    <span>Eliminar</span>
                  </button>
                </mat-menu>
              </div>
            </div>
            <div class="budget-card__date-range">
              <span class="material-icons">event</span>
              <span
                >{{ item.startDate | date: 'dd MMM' }} -
                {{ item.endDate | date: 'dd MMM yyyy' }}</span
              >
            </div>
          </div>

          <div class="budget-card__stats">
            <div class="stat-item">
              <span class="stat-item__label">Ingresos:</span>
              <span class="stat-item__value stat-item__value--income">
                {{
                  item.totalIncomes | currency: item.currency : 'symbol-narrow' : '1.0-0'
                }}
              </span>
            </div>
            <div class="stat-item">
              <span class="stat-item__label">Gastos:</span>
              <span class="stat-item__value stat-item__value--expense">
                {{
                  item.totalExpenses | currency: item.currency : 'symbol-narrow' : '1.0-0'
                }}
              </span>
            </div>
            <div class="stat-item stat-item--highlight">
              <span class="stat-item__label">Disponible:</span>
              <span class="stat-item__value stat-item__value--available">
                {{
                  item.availableMoney
                    | currency: item.currency : 'symbol-narrow' : '1.0-0'
                }}
              </span>
            </div>
          </div>

          <div class="budget-card__progress">
            <div class="progress-info">
              <span class="progress-info__label">Progreso del presupuesto</span>
              <span class="progress-info__value" [style.color]="getProgressColor(item)">
                {{ item.percentageUsed | number: '1.0-0' }}%
              </span>
            </div>
            <mat-progress-bar
              mode="determinate"
              [value]="item.percentageUsed"
              [color]="getProgressBarColor(item)"
            ></mat-progress-bar>
          </div>

          <div class="budget-card__footer">
            <div class="budget-card__days">
              <span class="material-icons">schedule</span>
              <span>{{ item.daysRemaining }} d√≠as restantes</span>
            </div>
            <fs-button
              label="Ver detalles"
              variant="secondary"
              (click)="viewBudget(item.id)"
            ></fs-button>
          </div>
        </div>
      }
    </div>
  } @else {
    <div class="budgets__empty">
      <div class="empty-state">
        <span class="material-icons">account_balance_wallet</span>
        <h3>No tienes presupuestos</h3>
        <p>Crea tu primer presupuesto para comenzar a administrar tus finanzas</p>
        <fs-button (click)="newBudget()" icon="add" label="Crear presupuesto"></fs-button>
      </div>
    </div>
  }
</div>
